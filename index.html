<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escape The Loop</title>
<style>
body { margin:0; background:#111; display:flex; flex-direction:column; align-items:center; color:white; font-family:monospace; user-select:none; }
canvas { border:2px solid #0ff; margin-top:20px; background:#000; }
h1 { margin-top:20px; color:#0ff; }
</style>
</head>
<body>
<h1>Escape The Loop</h1>
<canvas id="gameCanvas" width="640" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const tileSize = 40;

// ----------------- GAME STATE -----------------
let currentLevel = 0;
let player = {x:1, y:1};
let keysCollected = 0;
let score = 0;
let gameOver = false;
let victory = false;
let gameStarted = false;

// ----------------- LEVELS -----------------
let levels = [
  // LEVEL 1
  {
    maze:[
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1],
      [1,1,1,0,1,1,1,1,1,1,0,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ],
    keys:[{x:3,y:1},{x:6,y:5}],
    diamonds:[{x:2,y:6}],
    enemies:[{x:10,y:3,speed:0.015},{x:7,y:7,speed:0.012}],
    portal:{x:14,y:13}
  },
  // LEVEL 2
  {
    maze:[
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,1],
      [1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1],
      [1,1,1,0,1,1,1,1,1,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ],
    keys:[{x:2,y:1},{x:5,y:5},{x:12,y:9}],
    diamonds:[{x:3,y:6},{x:11,y:4}],
    enemies:[{x:10,y:3,speed:0.02},{x:7,y:7,speed:0.018},{x:12,y:11,speed:0.017}],
    portal:{x:14,y:13}
  },
  // LEVEL 3
  {
    maze:[
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],
      [1,0,1,1,0,1,0,1,1,0,1,0,1,1,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ],
    keys:[{x:2,y:1},{x:5,y:5},{x:12,y:9},{x:3,y:10}],
    diamonds:[{x:3,y:6},{x:11,y:4},{x:7,y:12}],
    enemies:[{x:10,y:3,speed:0.018},{x:7,y:7,speed:0.016},{x:12,y:11,speed:0.015},{x:4,y:9,speed:0.014}],
    portal:{x:14,y:13}
  },
  // LEVEL 4
  {
    maze:[
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],
      [1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1],
      [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ],
    keys:[{x:2,y:1},{x:5,y:5},{x:12,y:9},{x:3,y:10}],
    diamonds:[{x:3,y:6},{x:11,y:4},{x:7,y:12},{x:10,y:10}],
    enemies:[{x:10,y:3,speed:0.017},{x:7,y:7,speed:0.016},{x:12,y:11,speed:0.015},{x:4,y:9,speed:0.014},{x:6,y:5,speed:0.013}],
    portal:{x:14,y:13}
  },
  // LEVEL 5
  {
    maze:[
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1],
      [1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
      [1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1],
      [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
      [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1],
      [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
